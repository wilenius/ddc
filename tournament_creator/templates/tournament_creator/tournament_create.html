{% extends 'tournament_creator/base.html' %}

{% block title %}Create Tournament - DDC Tournament Manager{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8 offset-md-2">
        <h2>Create New Tournament</h2>
        <form method="post">
            {% csrf_token %}
            <div class="card mb-4">
                <div class="card-header">
                    Tournament Settings
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">Tournament Name</label>
                        <input type="text" name="name" class="form-control" required value="{{ request.GET.name|default:'' }}">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Tournament Date</label>
                        <input type="date" name="date" class="form-control" required value="{{ request.GET.date|default:'' }}">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Tournament Type</label>
                        <select name="archetype" id="archetype-select" class="form-select" required>
                            <option value="">Select a tournament type</option>
                            {% for archetype in archetypes %}
                                <option value="{{ archetype.id }}" {% if archetype.id|stringformat:'s' == request.GET.archetype %}selected{% endif %}>{{ archetype.name }}</option>
                            {% endfor %}
                        </select>
                        <script>
document.addEventListener('DOMContentLoaded', function() {
    var select = document.getElementById('archetype-select');
    select.addEventListener('change', function() {
        // Collect form values
        var name = document.querySelector('input[name="name"]').value;
        var date = document.querySelector('input[name="date"]').value;
        var url = "{% url 'tournament_create' %}?archetype=" + this.value +
                  "&name=" + encodeURIComponent(name) +
                  "&date=" + encodeURIComponent(date);
        window.location = url;
    });
});
</script>
                    </div>
                </div>
            </div>

            {% if archetype and archetype.tournament_category == "MOC" %}
                <div class="card mb-4">
                    <div class="card-header">Select Players</div>
                    <div class="card-body">
                        <div class="mb-3">
                            {{ moc_player_form.players }}
                        </div>
                    </div>
                </div>
            {% endif %}
            <div class="text-center">
                <button type="submit" class="btn btn-primary">Create Tournament</button>
                <a href="{% url 'tournament_list' %}" class="btn btn-secondary">Cancel</a>
            </div>
        </form>
    </div>
</div>
{% endblock %}